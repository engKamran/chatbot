<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visitor - Live Chat with Admin</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- Chatbox Container -->
  <div class="chatbox-container">
    <!-- Chat Header -->
    <div class="chatbox-header">
      <div class="chatbox-header-left">
        <div class="chatbox-avatar">👨‍💼</div>
        <div class="chatbox-header-info">
          <h2>Live Support</h2>
          <p id="chatboxStatus" class="chatbox-status-text">
            <span class="live-badge">🔴 LIVE</span>
            <span id="statusText">Admin Online</span>
          </p>
        </div>
      </div>
      <div class="chatbox-header-right">
        <div class="status-dot active" id="chatboxStatusDot"></div>
      </div>
    </div>

    <!-- Chat Content -->
    <div class="chatbox-content">
      <!-- Messages Area -->
      <div id="messagesArea" class="messages-area">
        <div class="message-group welcome-message">
          <div class="message-avatar">🎥</div>
          <div class="message-content">
            <p><strong>Welcome to Live Support!</strong></p>
            <p>🔴 Our admin is <strong>LIVE NOW</strong> and ready to stream!</p>
            <p>Enter your name below to join the queue and watch the live stream.</p>
          </div>
        </div>
      </div>

      <!-- Join Queue Section -->
      <div id="joinQueueSection" class="chat-input-section">
        <div class="input-group-inline">
          <input type="text" id="visitorName" placeholder="Your name" value="Visitor" class="chat-name-input">
          <button class="btn-primary btn-icon" onclick="joinQueue()" title="Join Queue">→</button>
        </div>
      </div>

      <!-- Waiting Section -->
      <div id="waitingSection" style="display: none;" class="chat-input-section">
        <div class="queue-info">
          <p>Position in queue: <strong id="queuePos">-</strong></p>
          <button class="btn-secondary btn-small" onclick="leaveQueue()">Leave Queue</button>
        </div>
      </div>

      <!-- Stream Section -->
      <div id="streamSection" style="display: none;" class="chat-input-section">
        <div class="video-container-chat" style="position: relative; height: 300px;">
          <video id="remoteVideo" autoplay playsinline></video>

          <!-- Loading Screen -->
          <div id="loadingScreen" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20;">
            <div style="text-align: center; color: white;">
              <div style="font-size: 48px; margin-bottom: 20px; animation: spin 2s linear infinite;">⏳</div>
              <p style="font-size: 14px; margin-bottom: 10px;">Connecting to Admin Stream...</p>
              <p style="font-size: 11px; color: #999;">Please wait while we establish the connection</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Rejected Section -->
      <div id="rejectedSection" style="display: none;" class="chat-input-section">
        <div class="rejection-message">
          <p>❌ Your request was rejected by the admin</p>
          <button class="btn-primary btn-small" onclick="rejoinQueue()">Try Again</button>
        </div>
      </div>
    </div>

    <!-- Chat Footer -->
    <div class="chatbox-footer">
      <div class="chat-input-wrapper">
        <input type="text" id="messageInput" placeholder="Type a message..." class="message-input" onkeypress="handleMessageKeypress(event)">
        <button class="btn-send" onclick="sendMessage()" title="Send message">📤</button>
      </div>
      <button class="btn-danger btn-full" id="leaveStreamBtn" onclick="endStream()" style="display: none;">Leave Stream</button>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script src="/js/webrtc-utils.js"></script>
  <script src="/js/visitor.js"></script>
</body>
</html>

