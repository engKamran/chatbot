<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Visitor - Live Chat with Admin</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <!-- Chatbox Container -->
  <div class="chatbox-container">
    <!-- Chat Header -->
    <div class="chatbox-header">
      <div class="chatbox-header-left">
        <div class="chatbox-avatar">👨‍💼</div>
        <div class="chatbox-header-info">
          <h2>Admin Support</h2>
          <p id="chatboxStatus" class="chatbox-status-text">Ready to connect</p>
        </div>
      </div>
      <div class="chatbox-header-right">
        <div class="status-dot" id="chatboxStatusDot"></div>
      </div>
    </div>

    <!-- Chat Content -->
    <div class="chatbox-content">
      <!-- Join Queue Section -->
      <div id="joinQueueSection" class="chat-section">
        <div class="chat-message-center">
          <div style="font-size: 48px; margin-bottom: 20px;">👋</div>
          <h3>Welcome to Admin Support</h3>
          <p>Enter your name and join the queue to chat with an available admin</p>
          <div class="input-group" style="margin-top: 20px;">
            <input type="text" id="visitorName" placeholder="Your name" value="Visitor">
            <button class="btn-primary" onclick="joinQueue()">Join Queue</button>
          </div>
        </div>
      </div>

      <!-- Waiting Section -->
      <div id="waitingSection" style="display: none;" class="chat-section">
        <div class="chat-message-center">
          <div style="font-size: 48px; margin-bottom: 20px; animation: spin 2s linear infinite;">⏳</div>
          <h3>Waiting for Admin</h3>
          <p>You're in the queue</p>
          <div class="queue-position-badge">
            Position: <strong id="queuePos">-</strong>
          </div>
          <button class="btn-secondary" onclick="leaveQueue()" style="margin-top: 20px;">Leave Queue</button>
        </div>
      </div>

      <!-- Stream Section -->
      <div id="streamSection" style="display: none;" class="chat-section">
        <div class="video-container-chat" style="position: relative;">
          <video id="remoteVideo" autoplay playsinline></video>

          <!-- Loading Screen -->
          <div id="loadingScreen" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20;">
            <div style="text-align: center; color: white;">
              <div style="font-size: 48px; margin-bottom: 20px; animation: spin 2s linear infinite;">⏳</div>
              <p style="font-size: 16px; margin-bottom: 10px;">Connecting to Admin Stream...</p>
              <p style="font-size: 12px; color: #999;">Please wait while we establish the connection</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Rejected Section -->
      <div id="rejectedSection" style="display: none;" class="chat-section">
        <div class="chat-message-center">
          <div style="font-size: 48px; margin-bottom: 20px;">❌</div>
          <h3>Request Rejected</h3>
          <p>The admin declined your request</p>
          <button class="btn-primary" onclick="rejoinQueue()" style="margin-top: 20px;">Try Again</button>
        </div>
      </div>
    </div>

    <!-- Chat Footer -->
    <div class="chatbox-footer" id="chatboxFooter" style="display: none;">
      <button class="btn-danger btn-full" onclick="endStream()">Leave Stream</button>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  <script src="/js/webrtc-utils.js"></script>
  <script src="/js/visitor.js"></script>
</body>
</html>

